<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abstract Assistant</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    .narrative {
      max-width: 40rem;
    }

    textarea {
      border: none !important;
      field-sizing: content;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary" data-bs-theme="dark">
    <div class="container-fluid">
      <a class="navbar-brand" href=".">Abstract Assistant</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="nav-item dropdown ms-auto" role="group" aria-label="Toggle dark mode" title="Toggle Dark Mode">
          <button class="dark-theme-toggle btn btn-outline-light dropdown-toggle" type="button"
            data-bs-toggle="dropdown" aria-expanded="false" aria-label="Toggle theme (auto)">
            <i class="bi bi-circle-half"></i> <span class="d-lg-none ms-2">Toggle theme</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><button class="dropdown-item" data-bs-theme-value="light"><i class="me-2 bi bi-sun-fill"></i>
                Light</button></li>
            <li><button class="dropdown-item" data-bs-theme-value="dark"><i class="me-2 bi bi-moon-stars-fill"></i>
                Dark</button></li>
            <li><button class="dropdown-item" data-bs-theme-value="auto"><i class="me-2 bi bi-circle-half"></i>
                Auto</button></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <main>
    <div class="container-fluid">
      <h3 class="display-6">AI-powered PDF Abstract Generation Service</h2>

        <div class="container mt-5">
          <div class="row">
            <div class="col-12">
              <form id="pdf-upload-form">
                <div class="row">
                  <div class="col-4">
                    <input type="file" class="form-control" id="pdf-file" accept=".pdf" />
                  </div>
                  <div class="col-2">
                    <button type="submit" class="btn btn-primary form-control" id="upload-button">
                      <i class="bi-upload me-2"></i>Upload
                    </button>
                  </div>
                </div>
              </form>
              <div id="upload-status" class="mt-2"></div>
            </div>
          </div>
          <div class="row mt-4">
            <div class="col-6" style="height: 100%;">
              <div class="card">
                <div class="card-header">
                  <h5 class="card-title">
                    <i class="bi-file-earmark-text me-2"></i>Guidelines
                  </h5>
                </div>
                <div class="card-body">
                  <div id="guidelines-display">
                    <textarea class="form-control" id="guidelines" title="guidelines">You will receive text content from a PDF chapter.
Your task is to write an abstract for this chapter following these guidelines:
(1) Begin with a clear and engaging opening sentence in active voice that sets expectations for the chapter. This sentence should succinctly summarize the chapter's main focus and provide a one-sentence overview of what the reader can anticipate.
(2) If the chapter introduces multiple concepts, summarize each one in the order they appear in the text. Ensure that the presentation is organized and easy to follow, using headings or bullet points if necessary to delineate each concept.
(3) Summarize the main closing argument presented in the chapter, including its implications as discussed by the author. If the chapter does not contain a designated conclusions section, please omit this part entirely.
Following the specified guidelines:
Maximum 150 words.
Refer to the content as 'Chapter'.
Use 'this chapter' instead of the chapter title.
Do not include any additional titles.
Do not include any graphics, tables, equations, or references.
Write the abstract as a single paragraph.
Follow basic US versus UK language consistency and punctuation rules.
Write concise sentences under 25 words.
Fully expand abbreviations/acronyms on first use.
Spell out numbers one to ten.
Do not start sentences with common conjunctions like 'Because', 'And'.
Do not use contractions such as 'don't'.
Do not use 'etc.'.
'%' need not be spelled out.
Use the appropriate international abbreviations for all units of measurement when necessary.
Use sentences as present in the original content.
Avoid first-person singular and second-person pronouns.
Use the past tense for findings, experiments, history.
Use present tense for current ideas and proposals.
Use future tense for further studies or suggestions.
Sentences need to be in active voice the extent possible. Do not change sentences that are passive in the original chapter content.
Avoid repetition by combining similar sentences.
Avoid excessive jargon.</textarea>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-6" style="height: 100%;">
              <div class="card">
                <div class="card-header">
                  <h5 class="card-title">
                    <i class="bi-file-earmark-text me-2"></i>Generated Abstract
                  </h5>
                </div>
                <div class="card-body">
                  <div id="abstract-display" contenteditable></div>
                </div>
              </div>
            </div>
          </div>
        </div>
  </main>

  <footer class="my-1 d-flex align-items-center justify-content-center">
    <p>Designed by <a href="https://straive.com/"
        class="text-reset link-offset-3 link-underline link-underline-opacity-25">Straive</a></h1>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" type="module"></script>
  <script src="https://cdn.jsdelivr.net/npm/@gramex/ui@0.3/dist/dark-theme.js" type="module"></script>
  <script type="module">
    import * as pdfjs from "https://cdn.jsdelivr.net/npm/pdfjs-dist@4/+esm";
    pdfjs.GlobalWorkerOptions.workerSrc = "https://cdn.jsdelivr.net/npm/pdfjs-dist@4/build/pdf.worker.min.mjs";

    const uploadForm = document.getElementById('pdf-upload-form');
    const pdfFile = document.getElementById('pdf-file');
    const uploadStatus = document.getElementById('upload-status');
    const abstractDisplay = document.getElementById('abstract-display');
    const guidelines = document.getElementById('guidelines');

    uploadForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      uploadStatus.innerHTML = '<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>';
      try {
        const file = pdfFile.files[0];
        if (!file) {
          throw new Error("Please select a PDF file.");
        }
        const pdf = await pdfjs.getDocument(await file.arrayBuffer()).promise;
        const numPages = pdf.numPages;
        let textContent = '';
        for (let i = 1; i <= numPages; i++) {
          const page = await pdf.getPage(i);
          textContent += await page.getTextContent().then(content => content.items.map(item => item.str).join(' '));
        }
        const response = await fetch("https://llmfoundry.straive.com/openai/v1/chat/completions", {
          method: "POST",
          headers: { "Content-Type": "application/json", "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFwcC5zdXBwb3J0QHN0cmFpdmUuY29tIn0.jtmsHvX3ZNoQ-1xwtvmV6BZkMA0D7wMmSlmxVKfuaR8:pdf_summary" },
          credentials: "include",
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [
              { role: "system", content: "You are an abstract generator." + guidelines.value },
              { role: "user", content: textContent }
            ],
          })
        });
        const result = await response.json();
        if (result.choices?.[0]?.message?.content) {
          abstractDisplay.innerHTML = result.choices?.[0]?.message?.content;
          uploadStatus.innerHTML = '<div class="alert alert-success"><i class="bi-check-circle-fill me-2"></i>Abstract generated successfully!</div>';
        } else if (result.error?.message) {
          throw new Error(result.error?.message);
        } else {
          throw new Error("Unexpected error occurred.");
        }
      } catch (error) {
        uploadStatus.innerHTML = `<div class="alert alert-danger"><i class="bi-exclamation-triangle-fill me-2"></i>${error.message}</div>`;
      }
    });
  </script>
</body>

</html>