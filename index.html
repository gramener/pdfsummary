<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="https://straive.com/favicon.ico" />
  <title>Abstract Assistant</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    .narrative {
      max-width: 40rem;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary" data-bs-theme="dark">
    <div class="container-fluid">
      <a class="navbar-brand" href=".">Abstract Assistant</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="nav-item dropdown ms-auto" role="group" aria-label="Toggle dark mode" title="Toggle Dark Mode">
          <button class="dark-theme-toggle btn btn-outline-light dropdown-toggle" type="button"
            data-bs-toggle="dropdown" aria-expanded="false" aria-label="Toggle theme (auto)">
            <i class="bi bi-circle-half"></i> <span class="d-lg-none ms-2">Toggle theme</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><button class="dropdown-item" data-bs-theme-value="light"><i class="me-2 bi bi-sun-fill"></i>
                Light</button></li>
            <li><button class="dropdown-item" data-bs-theme-value="dark"><i class="me-2 bi bi-moon-stars-fill"></i>
                Dark</button></li>
            <li><button class="dropdown-item" data-bs-theme-value="auto"><i class="me-2 bi bi-circle-half"></i>
                Auto</button></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <main>
    <div class="container-fluid">
      <h3 class="display-6 text-center">AI-powered PDF Abstract Generation Service</h2>

        <div class="container mt-5">
          <div class="row">
            <div class="col-12">
              <form id="pdf-upload-form">
                <div class="row d-flex justify-content-center">
                  <div class="col-4">
                    <input type="file" class="form-control" id="pdf-file" accept=".pdf" />
                  </div>
                  <div class="col-2">
                    <button type="submit" class="btn btn-primary form-control" id="upload-button">
                      <i class="bi-upload me-2"></i>Upload
                    </button>
                  </div>
                </div>
              </form>
              <div id="upload-status" class="mt-2"></div>
            </div>
          </div>
          <div class="row mt-4">
            <div class="col-6" style="height: 100%;">
              <div class="card">
                <div class="card-header">
                  <h5 class="card-title">
                    <i class="bi-file-earmark-text me-2"></i>Guidelines
                  </h5>
                </div>
                <div class="card-body">
                  <div id="guidelines-display" class="form-control" style="white-space: pre-line;" contenteditable>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-6" style="height: 100%;">
              <div class="card">
                <div class="card-header">
                  <h5 class="card-title d-flex justify-content-between">
                    <span><i class="bi-file-earmark-text me-2"></i>Generated Abstract</span>
                    <a class="button" id="abstract-download" title="Download"><i class="bi-download"></i></a>
                  </h5>
                </div>
                <div class="card-body">
                  <div id="abstract-display" class="form-control" contenteditable><!--white-space: pre-line--></div>
                </div>
              </div>
            </div>
          </div>
        </div>
  </main>

  <footer class="my-1 d-flex align-items-center justify-content-center">
    <p>Designed by <a href="https://straive.com/"
        class="text-reset link-offset-3 link-underline link-underline-opacity-25">Straive</a></h1>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" type="module"></script>
  <script src="https://cdn.jsdelivr.net/npm/@gramex/ui@0.3/dist/dark-theme.js" type="module"></script>
  <script type="module">
    import * as pdfjs from "https://cdn.jsdelivr.net/npm/pdfjs-dist@4/+esm";
    pdfjs.GlobalWorkerOptions.workerSrc = "https://cdn.jsdelivr.net/npm/pdfjs-dist@4/build/pdf.worker.min.mjs";

    import markdownIt from 'https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/+esm'

    const uploadForm = document.getElementById('pdf-upload-form');
    const pdfFile = document.getElementById('pdf-file');
    const uploadStatus = document.getElementById('upload-status');
    const abstractDisplay = document.getElementById('abstract-display');
    const guidelineDisplay = document.getElementById('guidelines-display');

    uploadForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      uploadStatus.innerHTML = '<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>';
      try {
        const file = pdfFile.files[0];
        if (!file) {
          throw new Error("Please select a PDF file.");
        }
        let guidelines = guidelineDisplay.innerText ?? guidelineDisplay.value;
        if (!guidelines || guidelines === undefined || guidelines.length === 0 || guidelines === 'undefined') {
          throw new Error("Please provide the guidelines.");
        }
        sessionStorage.setItem('guidelines', guidelines);
        const pdf = await pdfjs.getDocument(await file.arrayBuffer()).promise;
        const numPages = pdf.numPages;
        let textContent = '';
        for (let i = 1; i <= numPages; i++) {
          const page = await pdf.getPage(i);
          textContent += await page.getTextContent().then(content => content.items.map(item => item.str).join(' '));
        }
        const response = await fetch("https://llmfoundry.straive.com/openai/v1/chat/completions", {
          method: "POST",
          headers: { "Content-Type": "application/json", "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFwcC5zdXBwb3J0QHN0cmFpdmUuY29tIn0.jtmsHvX3ZNoQ-1xwtvmV6BZkMA0D7wMmSlmxVKfuaR8:pdf_summary" },
          credentials: "include",
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [
              { role: "system", content: "You are an abstract generator." + guidelines },
              { role: "user", content: textContent }
            ],
          })
        });
        const result = await response.json();
        if (result.choices?.[0]?.message?.content) {
          const md = markdownIt();
          abstractDisplay.innerHTML = md.renderInline(result.choices?.[0]?.message?.content);
          uploadStatus.innerHTML = '<div class="alert alert-success"><i class="bi-check-circle-fill me-2"></i>Abstract generated successfully!</div>';
        } else if (result.error?.message) {
          throw new Error(result.error?.message);
        } else {
          throw new Error("Unexpected error occurred.");
        }
      } catch (error) {
        uploadStatus.innerHTML = `<div class="alert alert-danger"><i class="bi-exclamation-triangle-fill me-2"></i>${error.message}</div>`;
      }
    });
  </script>
  <script>
    document.getElementById('abstract-download').addEventListener('click', function () {
      const abstractDisplay = document.getElementById('abstract-display');
      const htmlContent = `<html><head><meta charset="UTF-8"><title>Abstract</title></head><body>${abstractDisplay?.innerHTML}</body></html>`;
      const blob = new Blob([htmlContent], { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'abstract.doc';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    document.addEventListener("DOMContentLoaded", (event) => {
      let guidelines = sessionStorage.getItem('guidelines');
      if (!guidelines || guidelines === undefined || guidelines.length === 0 || guidelines === 'undefined') {
        guidelines = `You will receive text content from a PDF chapter.\nYour task is to write an abstract for this chapter following these guidelines:\n1. Begin with a clear and engaging opening sentence in active voice that sets expectations for the chapter. This sentence should succinctly summarize the chapter's main focus and provide a one-sentence overview of what the reader can anticipate.\n2. If the chapter introduces multiple concepts, summarize each one in the order they appear in the text. Ensure that the presentation is organized and easy to follow, using headings or bullet points if necessary to delineate each concept.\n3. Summarize the main closing argument presented in the chapter, including its implications as discussed by the author. If the chapter does not contain a designated conclusions section, please omit this part entirely.\nFollowing the specified guidelines:\nMaximum 150 words.\nRefer to the content as 'Chapter'.\nUse 'this chapter' instead of the chapter title.\nDo not include any additional titles.\nDo not include any graphics, tables, equations, or references.\nWrite the abstract as a single paragraph.\nFollow basic US versus UK language consistency and punctuation rules.\nWrite concise sentences under 25 words.\nFully expand abbreviations/acronyms on first use.\nSpell out numbers one to ten.\nDo not start sentences with common conjunctions like 'Because', 'And'.\nDo not use contractions such as 'don't'.\nDo not use 'etc.'.\n'%' need not be spelled out.\nUse the appropriate international abbreviations for all units of measurement when necessary.\nUse sentences as present in the original content.\nAvoid first-person singular and second-person pronouns.\nUse the past tense for findings, experiments, history.\nUse present tense for current ideas and proposals.\nUse future tense for further studies or suggestions.\nSentences need to be in active voice the extent possible. Do not change sentences that are passive in the original chapter content.\nAvoid repetition by combining similar sentences.\nAvoid excessive jargon.`;
      }
      const guidelineDisplay = document.getElementById('guidelines-display');
      guidelineDisplay.innerText = guidelines;
    });
  </script>
</body>

</html>